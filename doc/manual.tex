% Copyright (c) 2010 Guillaume Collet
% 
% Permission is hereby granted, free of charge, to any person obtaining a copy
% of this software and associated documentation files (the "Software"), to deal
% in the Software without restriction, including without limitation the rights
% to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
% copies of the Software, and to permit persons to whom the Software is
% furnished to do so, subject to the following conditions:
% 
% The above copyright notice and this permission notice shall be included in
% all copies or substantial portions of the Software.
% 
% THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
% FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
% AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
% LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
% OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
% THE SOFTWARE. 
%


\documentclass[12pt]{report}
\usepackage{geometry}
\geometry{a4paper} 
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{epstopdf}
\usepackage{hyperref}
\DeclareGraphicsRule{.tif}{png}{.png}{`convert #1 `dirname #1`/`basename #1 .tif`.png}

\title{MstatX User Manual}
\author{Guillaume Collet}
\date{\today}

\renewcommand*{\thesection}{\arabic{section}}

\begin{document}

% Title Page
\maketitle
\thispagestyle{empty} \newpage

% Blank Page
\thispagestyle{empty}  \null \newpage

% Table of contents
\setcounter{tocdepth}{3}
\tableofcontents
\thispagestyle{empty} 
\newpage

% Begin the document
\setcounter{page}{1}
\section{Introduction}
MstatX aims to provide a simple and easy-to-extend solution for multiple alignment statistics calculation. 
A multiple alignment is simply defined by an alphabet of symbols and a list of words made with this alphabet.
The definition of statistics calculation is completely independant and can be seen as a module or a plug-in.\\

The default usage of MstatX is for multiple alignment of protein sequences, so, it uses amino acids substitution 
matrix to calculate statistics. But it is possible to use it for any alphabet with any scoring scheme defined by 
the user.\\

MstatX has two side: the end-user side and the programmer side. 
If you wants to calculate statistics already available in MstatX, then read the section \ref{user_sec}. 
If you want to add a new statistics module in MstatX, then read the section \ref{prog_sec} to have some examples of
already coded statistics modules.

\section{Installation}
If you read this, then you have downloaded MstatX from my \href{https://github.com/gcollet/MstatX}{github repository}.
When you are at the root of MstatX, just open a terminal and:
\begin{verbatim}
make
\end{verbatim}
This will compile MstatX with \verb g++ . So you need it in order to compile.\\

MstatX uses only one environment variable: \verb SCORE_MAT_PATH . 
This variable gives the path to the substitution matrices directory.
You can set this variable in your \verb .bashrc  file or you can also use the -sd option to specify the substitution matrices directory to MstatX.

\newpage
\section{User side} 
\label{user_sec}
This section is dedicated to the usage of MstatX. If you want to add a statistics module in MstatX, read section \ref{prog_sec}.\\

\subsection{Getting started}
The basic use of MstatX is like the following:
\begin{verbatim}
mstatx -ma example.mali
\end{verbatim}
This command will calculate the trident statistic of each columns in the multiple sequences alignment given in file \verb example.mali . The trident statistic scores are written in file \verb example.stat . Line $1$ of file \verb example.stat  corresponds to column $1$ in file \verb example.mali , etc. This definition allows the calculation of multiple scores for a given column.\\


The trident statistic is defined in section \ref{trid_stat}. 

\subsection{Options}
\label{opt_sec}

\subsection{Available statistics}
\label{stat_sec}

\subsubsection{Trident}
\label{trid_stat}
The trident statistic module is based on the work of William S.J. Valdar \cite{Valdar-2002}. 
It is composed of three parts, each measures a different aspect of column conservation.\\

The first part, noted $t(x)$, measures the entropy of a column $x$ by the Shannon formula:
\begin{equation}
 t(x) = \frac{1}{log(min(N,K))}\sum_{a=1}^{K}p_a log(p_a)
\end{equation}
In this formule, $N$ is the number of sequences in the multiple alignment, $K$ is the size of the alphabet, and $p_a$ is the probability of symbol $a$ in the column $x$. The redondancy between the sequences in the multiple alignement is measured in $p_a$ by this formula:
\begin{equation}
	p_a = \sum_{i \in \{i|s(i) = a\}} w_i
\end{equation}
In this formula, $w_i$ is the weight of sequence $i$ and it is added to the probability $p_a$ only if the symbol of sequence $i$ and column $x$ is $a$. The weight is calculated by the formula from Henikoff \& Henikoff \cite{Henikoff-1994}:
\begin{equation}
	w_i = \frac{1}{L} \sum_{x=1}^{L}\frac{1}{K_x n_{x_i}}
\end{equation}
In this formula, $L$ is the length of the alignment, 

\newpage
\section{Programmer side}
\label{prog_sec}

\subsection{The Statistics virtual class}
\label{cla_sec}

\bibliographystyle{plain}
\bibliography{biblio}

\end{document}  